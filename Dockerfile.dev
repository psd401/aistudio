# Development Dockerfile for Next.js AI Studio Application
# Issue #607 - Local Development Environment with Hot Reload
#
# This Dockerfile is optimized for development with:
# - Source code mounted as volume (not copied)
# - Dependencies pre-installed for fast startup
# - Hot module reloading enabled
#
# Usage:
#   docker compose -f docker-compose.dev.yml up
#
# Key differences from production Dockerfile:
# - Uses dev dependencies
# - No build step (source mounted at runtime)
# - Runs `npm run dev` instead of production server

FROM node:22-alpine

WORKDIR /app

# Install dependencies for native packages
RUN apk add --no-cache libc6-compat python3 make g++

# Copy package files first (for layer caching)
COPY package.json package-lock.json* ./

# Install ALL dependencies including devDependencies
RUN npm ci --legacy-peer-deps

# Don't copy source code - it's mounted as a volume
# The app will be run via docker-compose with volume mounts

# Set development environment
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV PORT=3000
ENV HOSTNAME=0.0.0.0

# Enable filesystem polling for hot reload in Docker
ENV WATCHPACK_POLLING=true

EXPOSE 3000

# Run Next.js dev server
CMD ["npm", "run", "dev"]
